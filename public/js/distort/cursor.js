import{lerp,getMousePos}from"./utils.js";let mouse={x:0,y:0};window.addEventListener("mousemove",(e=>mouse=getMousePos(e)));export class Cursor{constructor(e){this.DOM={el:e},this.DOM.lines=this.DOM.el.children,[this.DOM.lineHorizontal,this.DOM.lineVertical]=this.DOM.lines,gsap.set(this.DOM.lines,{opacity:0}),this.renderedStyles={tx:{previous:0,current:0,amt:.15},ty:{previous:0,current:0,amt:.15}},this.onMouseMoveEv=()=>{this.renderedStyles.tx.previous=this.renderedStyles.tx.current=mouse.x,this.renderedStyles.ty.previous=this.renderedStyles.ty.previous=mouse.y,gsap.to(this.DOM.lines,{duration:.9,ease:"Power3.easeOut",opacity:1}),requestAnimationFrame((()=>this.render())),window.removeEventListener("mousemove",this.onMouseMoveEv)},window.addEventListener("mousemove",this.onMouseMoveEv),this.filterId={x:"#filter-noise-x",y:"#filter-noise-y"},this.DOM.feTurbulence={x:document.querySelector(`${this.filterId.x} > feTurbulence`),y:document.querySelector(`${this.filterId.y} > feTurbulence`)},this.primitiveValues={turbulence:0},this.createNoiseTimeline()}enter(){this.tl.restart()}leave(){this.tl.progress(1).kill()}createNoiseTimeline(){this.tl=gsap.timeline({paused:!0,onStart:()=>{this.DOM.lineHorizontal.style.filter=`url(${this.filterId.x}`,this.DOM.lineVertical.style.filter=`url(${this.filterId.y}`},onUpdate:()=>{this.DOM.feTurbulence.x.setAttribute("baseFrequency",this.primitiveValues.turbulence),this.DOM.feTurbulence.y.setAttribute("baseFrequency",this.primitiveValues.turbulence)},onComplete:()=>{this.DOM.lineHorizontal.style.filter=this.DOM.lineVertical.style.filter="none"}}).to(this.primitiveValues,{duration:.5,ease:"power1",startAt:{turbulence:1},turbulence:0})}render(){this.renderedStyles.tx.current=mouse.x,this.renderedStyles.ty.current=mouse.y;for(const e in this.renderedStyles)this.renderedStyles[e].previous=lerp(this.renderedStyles[e].previous,this.renderedStyles[e].current,this.renderedStyles[e].amt);gsap.set(this.DOM.lineVertical,{x:this.renderedStyles.tx.previous}),gsap.set(this.DOM.lineHorizontal,{y:this.renderedStyles.ty.previous}),requestAnimationFrame((()=>this.render()))}}