import{MagneticFx}from"./magneticFx.js";import{calcWinsize,wrapElements}from"./utils.js";Splitting();let winsize=calcWinsize();window.addEventListener("resize",(()=>winsize=calcWinsize()));const frameEl=document.querySelectorAll(".frame");let viewcaseChars=document.querySelectorAll(".viewcase .char");export class Item{constructor(t,e){this.DOM={el:t},this.DOM.html=document.querySelector("html"),this.itemsArr=e,this.invert=this.DOM.el.classList.contains("item--invert"),this.DOM.imgWrap=this.DOM.el.querySelector(".item__imgwrap"),this.DOM.img=this.DOM.imgWrap.querySelector(".item__img"),this.DOM.enterAction=this.DOM.el.querySelector(".item__enter"),this.DOM.enterActionSVGCircle=this.DOM.enterAction.querySelector("circle"),gsap.set(this.DOM.enterActionSVGCircle,{transformOrigin:"50% 50%"}),this.magneticFx=new MagneticFx(this.DOM.enterAction),this.editHeadingLayout(),this.DOM.excerpt=this.DOM.el.querySelector(".item__excerpt"),this.DOM.excerptLink=this.DOM.excerpt.querySelector(".item__excerpt-link"),this.contentId=this.DOM.excerptLink.href.substring(this.DOM.excerptLink.href.lastIndexOf("#")),this.DOM.metaContent=[...this.DOM.el.querySelectorAll(".item__meta > .item__meta-row")],this.editContentLayout(),this.DOM.backCtrl=document.querySelector(".content__back"),this.initEvents()}editHeadingLayout(){this.DOM.heading=this.DOM.el.querySelector(".heading--item"),this.DOM.itemHeadingChars=[...this.DOM.heading.querySelectorAll(".char")],wrapElements(this.DOM.itemHeadingChars,"span","char-wrap")}editContentLayout(){this.DOM.contentEl=document.querySelector(this.contentId),this.DOM.contentElHeading=this.DOM.contentEl.querySelector(".heading"),this.DOM.contentHeadingChars=[...this.DOM.contentElHeading.querySelectorAll(".char")],wrapElements(this.DOM.contentHeadingChars,"span","char-wrap"),this.DOM.contentElText=[...this.DOM.contentEl.querySelectorAll(".content__detail > *")],this.DOM.imageMain=this.DOM.contentEl.querySelector(".project-image"),this.DOM.marquee=this.DOM.contentEl.querySelector(".design-marquee"),this.DOM.projeimage1=this.DOM.contentEl.querySelector(".product-image1"),this.DOM.projeimage2=this.DOM.contentEl.querySelector(".product-image2"),this.DOM.projeimage3=this.DOM.contentEl.querySelector(".product-image3")}initEvents(){this.DOM.enterAction.addEventListener("mouseenter",(()=>this.onMouseEnter())),this.DOM.enterAction.addEventListener("mouseleave",(()=>this.onMouseLeave())),this.DOM.enterAction.addEventListener("click",(()=>this.open())),this.DOM.excerptLink.addEventListener("mouseenter",(()=>this.onMouseEnter())),this.DOM.excerptLink.addEventListener("mouseleave",(()=>this.onMouseLeave())),this.DOM.excerptLink.addEventListener("click",(()=>this.open())),this.DOM.backCtrl.addEventListener("click",(()=>this.close()))}onMouseEnter(){this.timelineHoverOut&&this.timelineHoverOut.kill(),this.timelineHoverIn=gsap.timeline().addLabel("start",0).to(this.DOM.enterActionSVGCircle,{duration:.8,ease:"power3",scale:1.1},"start").to(this.DOM.imgWrap,{duration:.8,ease:"power3",scale:.95},"start").to(this.DOM.img,{duration:.8,ease:"power3",scale:1.1},"start").set(viewcaseChars,{opacity:0}).to(this.DOM.itemHeadingChars,{duration:.2,ease:"quad.in",x:this.invert?"103%":"-103%"},"start").set(this.DOM.heading,{x:this.invert?"20%":"-20%"},"start+=0").to(this.DOM.itemHeadingChars,{duration:.7,ease:"expo",startAt:{x:this.invert?"-103%":"103%"},x:"0%"},"start+=0.2").to(viewcaseChars,{duration:.1,ease:"expo",opacity:1,stagger:{amount:.5,grid:"auto",from:"random"}})}onMouseLeave(){this.isContentOpen||(this.timelineHoverIn&&this.timelineHoverIn.kill(),this.timelineHoverOut=gsap.timeline().addLabel("start",0).to(this.DOM.enterAction,{duration:.8,ease:"power3",x:0,y:0},"start").to(this.DOM.enterActionSVGCircle,{duration:.8,ease:"power3",scale:1},"start").to([this.DOM.imgWrap,this.DOM.img],{duration:.8,ease:"power3",scale:1},"start").to(this.DOM.itemHeadingChars,{duration:.2,ease:"quad.in",x:this.invert?"-103%":"103%"},"start").set(this.DOM.heading,{x:"0%"},"start+=0.2").to(this.DOM.itemHeadingChars,{duration:.7,ease:"expo",startAt:{x:this.invert?"103%":"-103%"},x:"0%"},"start+=0.2").set(viewcaseChars,{opacity:1}))}open(){this.magneticFx.stopRendering(),this.timelineHoverIn&&this.timelineHoverIn.kill(),this.timelineHoverClose&&this.timelineHoverClose.kill(),this.isContentOpen=!0,this.DOM.html.classList.add("oh"),this.DOM.contentEl.classList.add("content__article--open"),this.DOM.contentEl.classList.add("lenis");const t=this.DOM.enterAction.getBoundingClientRect();this.timelineHoverOpen=gsap.timeline().addLabel("start",0).set(this.DOM.contentHeadingChars,{x:this.invert?"-103%":"103%"},"start").to(".free-time",{zIndex:2}).set(this.DOM.contentElText,{opacity:0,y:"20%"},"start").set(this.DOM.imageMain,{opacity:0,y:"20%"},"start").set(this.DOM.backCtrl,{scale:.8,opacity:0},"start").to([frameEl,this.itemsArr.filter((t=>t!=this)).map((t=>t.DOM.el))],{duration:.6,ease:"power3",opacity:0},"start").to(this.DOM.enterAction,{duration:.8,ease:"power2",x:winsize.width/2-t.left-t.width/2,y:-t.top-t.height/2},"start").to(this.DOM.enterActionSVGCircle,{duration:2,ease:"power2",scale:2.3,opacity:0,onComplete:()=>gsap.set(this.DOM.enterAction,{x:0,y:0})},"start").to([this.DOM.excerpt,this.DOM.metaContent],{duration:.5,ease:"power4.in",y:t=>t?"-100%":"-8%",opacity:0,stagger:{from:"center",amount:.06}},"start").to(this.DOM.imgWrap,{duration:.5,ease:"power3.inOut",scale:.9,opacity:0},"start").to(this.DOM.itemHeadingChars,{duration:.3,ease:"quad.in",x:this.invert?"103%":"-103%"},"start").to(this.DOM.contentHeadingChars,{duration:1.3,ease:"expo",x:"0%",stagger:this.invert?-.03:.03},"start+=0.4").to(this.DOM.contentElText,{duration:1.3,ease:"expo",y:"0%",opacity:1,stagger:.03},"start+=0.7").to(this.DOM.imageMain,{duration:1.3,ease:"expo",y:"0%",opacity:1,stagger:.03},"start+=0.7").to(this.DOM.backCtrl,{duration:1.3,ease:"expo",scale:1,opacity:1},"start+=1").to(this.DOM.marquee,{duration:.5,ease:"power4.in",opacity:1,y:"0%",x:"0"},"start+1").to(this.DOM.projeimage1,{duration:.5,ease:"power4.in",opacity:1,scaleX:"100%",scaleY:"100%"},"start").to(this.DOM.projeimage2,{duration:.5,ease:"power4.in",opacity:1,scaleX:"100%",scaleY:"100%"},"start").to(this.DOM.projeimage3,{duration:.5,ease:"power3.in",opacity:1,scaleX:"100%",scaleY:"100%"},"start").to(".portfolio-map",{scale:0,duration:.6,ease:"power3"},"start")}close(){this.timelineHoverOpen&&this.timelineHoverOpen.kill(),this.isContentOpen=!1,this.timelineHoverClose=gsap.timeline().addLabel("start",0).set(this.DOM.enterAction,{x:0,y:0},"start").to(this.DOM.backCtrl,{duration:.3,ease:"quad.in",scale:.9,opacity:0},"start").set(this.DOM.enterActionSVGCircle,{scale:.5,opacity:0},"start+=0.4").to(".free-time",{zIndex:3}).to(this.DOM.enterActionSVGCircle,{duration:.6,ease:"expo",scale:1,opacity:1,onComplete:()=>{this.DOM.contentEl.classList.remove("content__article--open"),this.DOM.contentEl.classList.remove("lenis"),this.DOM.html.classList.remove("oh"),this.DOM.contentEl.scrollTop=0}},"start+=0.4").to(this.DOM.contentHeadingChars,{duration:.3,ease:"quad.in",x:this.invert?"-103%":"103%"},"start").to(this.DOM.itemHeadingChars,{duration:1.3,ease:"expo",x:"0%",stagger:this.invert?.01:-.01},"start+=0.4").to(this.DOM.contentElText,{duration:.5,ease:"power4.in",opacity:0,y:"20%"},"start").to(this.DOM.imageMain,{duration:.5,ease:"power4.in",opacity:0,y:"20%"},"start").to(this.DOM.marquee,{duration:.7,ease:"power4.in",opacity:0,y:"20%",x:"200"},"start").to(this.DOM.projeimage1,{duration:.5,ease:"power3.in",opacity:0,scaleX:"80%",scaleY:"20%"},"start").to(this.DOM.projeimage2,{duration:.5,ease:"power3.in",opacity:0,scaleX:"80%",scaleY:"20%"},"start").to(this.DOM.projeimage3,{duration:.5,ease:"power3.in",opacity:0,scaleX:"80%",scaleY:"20%"},"start").to(this.DOM.imgWrap,{duration:.8,ease:"power3",scale:1,opacity:1},"start+=0.4").to([this.DOM.excerpt,this.DOM.metaContent],{duration:1.3,ease:"expo",y:"0%",opacity:1,stagger:{from:"center",amount:.06}},"start+=0.4").to([frameEl,this.itemsArr.filter((t=>t!=this)).map((t=>t.DOM.el))],{duration:.6,ease:"power3",opacity:1},"start+=0.4").to(".portfolio-map",{scale:1,duration:.6,ease:"power3"})}}